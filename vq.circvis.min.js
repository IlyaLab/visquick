/** @namespace Top-level namespace, vq **/(function(a,b){typeof exports=="object"&&a.require?module.exports=b(require("underscore"),require("d3"),require("jquery"),require("vq")):typeof define=="function"&&define.amd?define(["underscore","d3","jquery","vq"],function(c,d,e,f){return b(c||a._,d||a.d3,e||a.$,f||a.vq)}):b(_,d3,$,vq)})(this,function(a,b,c,d){var e=function(e){function x(b){return a.uniq(a.flatten(a.chain(b).map(function(a){return[a.source||a.node1,a.target||a.node2]}).value()))}function r(d){var e=f._wedge[d];if(!!a.isFunction(e._y_linear)&&e._draw_axes){var g=e._y_linear.ticks(4);b.select('.ideogram .wedge[data-ring="'+d+'"] .axes').append("svg:g").attr("class","labels").selectAll("g.text").data(g).enter().append("svg:text").each(function(){c(this).disableSelection()}).attr("transform",function(a){return"translate(0,-"+e._y_linear(a)+")"}).text(function(a){return a})}}function p(c,d){function h(a){var d=f._wedge[a],e=d._plot_type;q[e]!==undefined&&q[e](c,a);var g=b.selectAll('.ideogram[data-region="'+c+'"] .wedge[data-ring="'+a+'"] .data > *');g.on("mouseover",function(a){d.hovercard.call(this,a)})}var e=this,g=a.isUndefined(d)||a.isNull(d);if(!g&&a.isNumber(d)&&a.isFinite(d)&&d>=f._wedge.length)console.error("drawWedgeData: Invalid wedge #:"+d);else{if(g){a.each(a.range(0,f._wedge.length),function(a){h.call(e,a)});return}h.call(e,d)}}function o(a,c){var d=f._ideograms[a],e=f._wedge[c],g=d.wedge[c],h=b.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+c+'"]');if(e._draw_axes){var i=f._chrom.groups[a],j=i.startAngle,k=i.angle,l=e._y_linear.ticks(4);h.append("svg:g").attr("class","axes").selectAll("path").data(l).enter().append("svg:path").style("fill","#ddd").style("stroke","#555").style("stroke-width","1.0px").attr("d",b.svg.arc().innerRadius(function(a){return e._y_linear(a)}).outerRadius(function(a){return e._y_linear(a)}).startAngle(0).endAngle(k))}p(a,c)}function n(a,b){var c=f._ideograms[a],d=f._wedge[b],e=c.wedge[b]}function m(c){function i(a){var d=b.select(this),e=f._wedge[a];if(e._plot_type!="karyotype"&&e._plot_type!="tile"&&e._plot_type!="band"&&e._plot_type!="glyph"){if(isNaN(e._min_plotValue)||isNaN(e._max_plotValue)){console.warn("Range of values for ring with index ("+a+") not detected.  Data has not been plotted.");return}e._min_plotValue==e._max_plotValue&&(e._min_plotValue=e._min_plotValue-1,e._max_plotValue=e._max_plotValue+1,console.warn("Invalid value range detected.  Range reset to [-1,1]."))}k(c,a)}function g(a){return f._wedge[a]._innerRadius}function e(a){return f._wedge[a]._outerPlotRadius}var d=b.select('.ideogram[data-region="'+c+'"]'),h=d.append("svg:g").attr("class","wedges").selectAll("path").data(a.range(0,f._wedge.length)).enter().append("svg:g").attr("class","wedge").attr("clip-path",function(a){return"url(#ring_clip_"+a+")"}).attr("data-ring",function(a){return a});h.append("svg:path").attr("class","background").attr("d",b.svg.arc().innerRadius(function(a){return g(a)}).outerRadius(function(a){return e(a)}).startAngle(0).endAngle(f._chrom.groups[c].angle)),h.append("svg:g").attr("class","data"),d.selectAll("g.wedge").each(i)}function l(a){var c=f._wedge[a]._outerRadius,d=f._wedge[a]._innerRadius,e=b.svg.arc()({innerRadius:d,outerRadius:c,startAngle:0,endAngle:2*Math.PI});b.select("svg .circvis defs").append("svg:clipPath").attr("id","ring_clip_"+a).append("svg:path").attr("d",e)}function k(a,c){var d=f._ideograms[a],e=b.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+c+'"]'),g=f._wedge[c];switch(g._plot_type){case"karyotype":case"tile":case"band":case"heatmap":case"glyph":p(a,c);break;default:o(a,c)}}var f=new d.models.CircVisData(e),g=function(){f.isDataReady()?h():console.warn("Invalid data input.  Check data for missing or improperly formatted values.");return this},h=function(){function j(a,b){}function h(a,b){}function g(a,c){function o(a,b){return a[0]*b[0]+a[1]*b[1]}function n(a,b){return a[0]*b[1]-a[1]*b[0]}var f=b.transform(b.select(this).attr("transform")),g=f.translate,h=f.scale,i=f.rotate,j=d/2*h[0],k=e/2*h[1],l=[b.event.x-j,b.event.y-k],m=[b.event.x-b.event.dx-j,b.event.y-b.event.dy-k],p=Math.atan2(n(m,l),o(m,l))*180/Math.PI;i+=p,b.select(this).attr("transform","translate("+g[0]+","+g[1]+")scale("+h+")rotate("+i+")")}var d=f._plot.width,e=f._plot.height,k=b.behavior.drag().on("dragstart",h).on("drag",g).on("dragend",j),m=f._plot.id,n=b.select(f._plot.container).append("svg:svg").attr("id",m).attr("width",d).attr("height",e).append("svg:g").attr("class","circvis").attr("transform","translate("+d/2+","+e/2+")").call(k);n.insert("svg:defs");var o=n.selectAll("g.ideogram").data(f._chrom.keys).enter().append("svg:g").attr("class","ideogram").attr("data-region",function(a){return a}).attr("opacity",1).attr("transform",function(a){return"rotate("+f._chrom.groups[a].startAngle*180/Math.PI+")"}).each(i),p=f._plot.height/2,q=p-f.ticks.outer_padding,s=q-f.ticks.height,t=(q+s)/2;o.append("text").attr("transform",function(a){return"rotate("+(f._chrom.groups[a].endAngle-f._chrom.groups[a].startAngle)*180/Math.PI/2+" )translate(0,-"+t+")"}).attr("class","region_label").attr("stroke","black").attr("text-anchor","middle").attr("dy",".35em").attr("cursor","pointer").text(function(a){return a}).each(function(){c(this).disableSelection()}).on("mouseover",function(b){var c={},d=f.normalizedLength[b],e=1-d,g=a.size(f.normalizedLength);a.each(f.normalizedLength,function(a,b,d){c[b]=a/e/2}),c[b]=.5});if(!a.isNull(f._chrom.radial_grid_line_width)&&f._chrom.radial_grid_line_width>0){var v=f._network.network_radius;o.selectAll("path.radial_lines").data(function(a){return[[{x:0,y:-1*q},{x:0,y:-1*v[a]}]]}).enter().insert("svg:path",".wedges").attr("class","radial_lines").attr("d",b.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"))}f._network._doRender&&w(n.insert("svg:g",".ideogram").attr("class","links")),a(a.range(0,f._wedge.length)).each(function(a){r(a),l(a)});return this},i=function(a){m(a),j(a)},j=function(b){f._chrom.groups[b]!==undefined&&(a(a.range(0,f._wedge.length)).each(function(a){p(b,a)}),s(b),f._network._doRender&&u(b))},q={barchart:function(a,c){var d=f._wedge[c],e=f._ideograms[a].wedge[c]||[],g=d._value_key,h=b.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+c+'"]'),i=function(c){var e=d._innerRadius,g=f._ideograms[a].theta(c.start),h=f._ideograms[a].theta(c.end);return b.svg.arc().innerRadius(e).startAngle(g).endAngle(h)},j=h.select("g.data").selectAll("path").data(e,d._hash);j.enter().append("svg:path").style("fill",d._fillStyle).style("stroke",d._strokeStyle).style("stroke-width",d._lineWidth).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).transition().duration(800).attrTween("d",function(a){var c=b.interpolate({outerRadius:d._innerRadius},{outerRadius:d._thresholded_outerRadius(a[g])}),e=i(a);return function(a){return e(c(a))}}).style("fill-opacity",1).style("stroke-opacity",1),j.exit().transition().duration(800).attrTween("d",function(a){var c=b.interpolate({outerRadius:d._thresholded_outerRadius(a[g])},{outerRadius:d._innerRadius}),e=i(a);return function(a){return e(c(a))}}).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},scatterplot:function(a,c){var e=f._wedge[c],g=f._ideograms[a].wedge[c]||[],h=e._value_key,i=d.utils.VisUtils.tileCenter,j=b.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+c+'"]'),k=j.select("g.data").selectAll("path").data(g,e._hash);k.enter().append("svg:path").style("fill",e._fillStyle).style("stroke",e._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("transform",function(b){return"rotate("+(f._ideograms[a].theta(i(b))*180/Math.PI-90)+")translate("+e._thresholded_value_to_radius(b[h])+")"}).attr("d",b.svg.symbol().type(e._shape).size(Math.pow(e._radius(),2))).transition().duration(800).style("fill-opacity",1).style("stroke-opacity",1),k.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},line:function(c,e){var g=f._wedge[e],h=a.sortBy(f._ideograms[c].wedge[e],"start"),i=g._value_key,j=d.utils.VisUtils.tileCenter,k=b.select('.ideogram[data-region="'+c+'"] .wedge[data-ring="'+e+'"]'),l=b.svg.line.radial().interpolate("basis").tension(.8).radius(function(a){return g._thresholded_value_to_radius(a[i])}).angle(function(a){return f._ideograms[c].theta(j(a))}),m=k.select("g.data").selectAll("path").data([h]);m.enter().append("svg:path").style("fill",g._fillStyle).style("stroke",g._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",l).transition().duration(800).style("stroke-opacity",1),m.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},area:function(c,e){var g=f._wedge[e],h=a.sortBy(f._ideograms[c].wedge[e],"start"),i=g._value_key,j=d.utils.VisUtils.tileCenter,k=b.select('.ideogram[data-region="'+c+'"] .wedge[data-ring="'+e+'"]'),l=b.svg.line.radial().interpolate("basis").tension(.8).radius(function(a){return g._thresholded_value_to_radius(a[i])}).angle(function(a){return f._ideograms[c].theta(j(a))}),m=b.svg.area.radial().interpolate("basis").tension(.8).innerRadius(function(a){return g._thresholded_innerRadius(a[i])}).outerRadius(function(a){return g._thresholded_outerRadius(a[i])}).angle(function(a){return f._ideograms[c].theta(j(a))}),n=k.select("g.data").selectAll("path").data([h]);n.enter().append("svg:path").style("fill",g._fillStyle).style("stroke",g._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",l).transition().duration(800).style("stroke-opacity",1),n.enter().append("svg:path").style("fill",g._fillStyle).style("stroke",g._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",m).transition().duration(800).style("fill-opacity",.7),n.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},band:function(a,c){var d=f._wedge[c],e=f._ideograms[a].wedge[c]||[],g=d._value_key,h=b.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+c+'"]'),i=h.select("g.data").selectAll("path").data(e,d._hash);i.enter().append("svg:path").style("fill",d._fillStyle).style("stroke",d._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",b.svg.arc().innerRadius(d._innerRadius).outerRadius(d._outerPlotRadius).startAngle(function(b){return f._ideograms[a].theta(b.start)}).endAngle(function(b){return f._ideograms[a].theta(b.end)})).transition().duration(800).style("fill-opacity",1).style("stroke-opacity",1),i.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},glyph:function(a,c){var e=d.utils.VisUtils.tileCenter,g=f._wedge[c],h=f._ideograms[a].wedge[c]||[],i=g._value_key,j=b.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+c+'"]'),k=j.select("g.data").selectAll("path").data(h,g._hash);k.enter().append("svg:path").style("fill",g._fillStyle).style("stroke",g._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("transform",function(b){return"rotate("+(f._ideograms[a].theta(e(b))*180/Math.PI-90)+")translate("+g._glyph_distance(b)+")"}).transition().duration(800).attr("d",b.svg.symbol().type(g._shape).size(Math.pow(g._radius(),2))).transition().duration(800).style("fill-opacity",1).style("stroke-opacity",1),k.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},tile:function(a,c){var d=f._wedge[c],e=f._ideograms[a].wedge[c]||[],g=d._value_key,h=b.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+c+'"]'),i=h.select("g.data").selectAll("path").data(e,d._hash);i.enter().append("svg:path").style("fill",d._fillStyle).style("stroke",d._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",b.svg.arc().innerRadius(function(a){return d._thresholded_tile_innerRadius(a,d)}).outerRadius(function(a){return d._thresholded_tile_outerRadius(a,d)}).startAngle(function(b){return f._ideograms[a].theta(b.start)}).endAngle(function(b){return f._ideograms[a].theta(b.end)})).transition().duration(800).style("fill-opacity",1).style("stroke-opacity",1),i.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},karyotype:function(a,c){var d=f._wedge[c],e=f._ideograms[a].wedge[c]||[],g=d._value_key,h=b.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+c+'"]'),i=h.select("g.data").selectAll("path").data(e,d._hash);i.enter().append("svg:path").style("fill",function(a){return a[g]}).style("stroke",d._strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",b.svg.arc().innerRadius(d._innerRadius).outerRadius(d._outerPlotRadius).startAngle(function(b){return f._ideograms[a].theta(b.start)}).endAngle(function(b){return f._ideograms[a].theta(b.end)})).transition().duration(800).style("fill-opacity",1).style("stroke-opacity",1),i.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},heatmap:function(a,c){var d=f._wedge[c],e=f._ideograms[a].wedge[c]||[],g=d._value_key,h=b.select('.ideogram[data-region="'+a+'"] .wedge[data-ring="'+c+'"]'),i=function(c){var e=f._ideograms[a].theta(c.start),g=f._ideograms[a].theta(c.end);return b.svg.arc().innerRadius(function(a){return d._innerRadius-a*4}).outerRadius(function(a){return d._outerPlotRadius+a*4}).startAngle(function(a){return e-a*Math.PI/360}).endAngle(function(a){return g+a*Math.PI/360})},j=h.select("g.data").selectAll("path").data(e,d._hash);j.enter().append("svg:path").style("fill",d._fillStyle).style("stroke",d._strokeStyle).style("stroke-width","1px").style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("d",b.svg.arc().innerRadius(d._innerRadius).outerRadius(d._outerPlotRadius).startAngle(function(b){return f._ideograms[a].theta(b.start)}).endAngle(function(b){return f._ideograms[a].theta(b.end)})).transition().duration(800).transition().duration(800).style("fill-opacity",1).style("stroke-opacity",1).attrTween("d",function(a){var c=b.interpolate(4,0),d=i(a);return function(a){return d(c(a))}}),j.exit().transition().duration(800).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()}};q.histogram=q.barchart;var s=function(a){var c=this;if(!!f.ticks.render_ticks){var e=f._data.hash,g=b.select('.ideogram[data-region="'+a+'"]'),h=function(a){return f.ticks._layout[e(a)]},i=f._plot.height/2,j=i-f.ticks.outer_padding,k=j-f.ticks.height,l=f.ticks.tile_ticks?function(a){return k+h(a)*f.ticks.wedge_height*1.3}:function(a){return k},m=function(a){return l(a)+f.ticks.wedge_height},n=function(a){return f.ticks.fill_style(a,e)},o=function(a){return f.ticks.stroke_style(a,e)},p=function(a){var b=s/l(a);return q(a)?b*2:b},q=function(a){return!0},r=Math.PI/180*f.ticks.wedge_width,s=r*k,u=d.utils.VisUtils.tileCenter,v=function(a){var c=l(a),d=m(a),e=f._ideograms[a.chr].theta(u(a)),g=p(a);return b.svg.arc().innerRadius(function(a){return c-a*4}).outerRadius(function(a){return d+a*4}).startAngle(function(a){return e-a*Math.PI/360}).endAngle(function(a){return e+g+a*Math.PI/360})},w=f._network.node_key;g.select("g.ticks").empty()&&g.append("svg:g").attr("class","ticks");var x=g.select("g.ticks").selectAll("path").data(f._data.chr[a],f._data.hash);x.enter().append("path").attr("class",function(a){return a[e]}).style("fill",n).style("stroke",o).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).on("mouseover",function(a){b.select("text[data-label='"+a[e]+"']").attr("visibility","visible"),f.ticks.hovercard.call(this,a)}).on("mouseout",function(a){b.select("text[data-label='"+a[e]+"']").attr("visibility","hidden")}).transition().duration(800).attrTween("d",function(a){var c=b.interpolate(4,0),d=v(a);return function(a){return d(c(a))}}).style("fill-opacity",1).style("stroke-opacity",1),x.exit().transition().duration(800).attrTween("d",function(a){var c=b.interpolate(0,4),d=v(a);return function(a){return d(c(a))}}).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove().each("end",t)}},t=function(a){delete f.ticks._layout[f._data.hash(a)]},u=function(c){var e=f._data.hash,g=function(a){return f._network.layout[e(a)]},h=d.utils.VisUtils.tileCenter,i=f._network.tile_nodes?function(a){return f._network.network_radius[c]-g(a)*2*f._network.node_radius(a)}:function(a){return f._network.network_radius[c]},j=b.select('.ideogram[data-region="'+c+'"]');j.select("g.nodes").empty()&&j.append("svg:g").attr("class","nodes");var k=j.select("g.nodes").selectAll("circle.node").data(a.where(f._data.features,{chr:c}),e),l=k.enter(),m=k.exit();l.append("svg:circle").attr("class","node").attr("cx",0).attr("cy",0).attr("r",function(a){return f._network.node_radius(a)*4}).style("fill",f._network.node_fillStyle).style("stroke",f._network.node_strokeStyle).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).attr("transform",function(a){return"rotate("+(f._ideograms[c].theta(h(a))/Math.PI*180-90)+")translate("+i(a)+")"}).on("mouseover",function(a){f._network.node_hovercard.call(this,a)}).transition().duration(800).attr("r",f._network.node_radius).style("stroke-opacity",1).style("fill-opacity",1),m.transition().duration(800).attr("r",function(a){return f._network.node_radius(a)*4}).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).remove()},v=function(a){delete f._network.layout[f._data.hash(a)]},w=function(){var c=f._data.hash,e=d.utils.VisUtils.tileCenter,g=function(a){return f._network.layout[c(a)]},h=b.layout.bundle(),i=f._network.tile_nodes?function(a){return f._network.network_radius[a.chr]-g(a)*2*f._network.node_radius(a)}:function(a){return f._network.network_radius[a.chr]},j=b.svg.line.radial().interpolate("bundle").tension(.65).radius(function(a){return a.radius!==undefined?a.radius:i(a)}).angle(function(a){return a.angle!==undefined?a.angle:f._ideograms[a.chr]._feature_angle(e(a))}),k=h(f._network.links_array).map(function(b,c){return a.extend(f._network.links_array[c],{spline:b})}),l=b.select("g.links").selectAll("path.link").data(k);l.enter().insert("svg:path").attr("class",function(a){return"link t_"+a.source.chr+" p_"+a.target.chr}).style("fill","none").style("stroke",f._network.link_strokeStyle).style("stroke-width",function(a){return f._network.link_line_width(a)*3}).style("stroke-opacity",1e-6).attr("d",function(a){return j(a.spline)}).on("mouseover",function(a){b.select(this).style("stroke-opacity",1),f._network.link_hovercard.call(this,a)}).on("mouseout",function(a){b.select(this).style("stroke-opacity",f._network.link_alpha(a))}).transition().duration(800).style("stroke-width",f._network.link_line_width).style("stroke-opacity",f._network.link_alpha),l.exit().transition().duration(800).style("stroke-opacity",1e-6).style("stroke-width",function(a){return f._network.link_line_width(a)*3}).remove()};g.size=function(a,c){var d,e;a.length&&a.length==2?(d=a[0],e=a[1]):arguments.length==1?d=e=a:(d=a,e=c);var g=d/f._plot.width,h=e/f._plot.height,i=b.select("#"+f._plot.id).select(".circvis"),j=b.transform(i.attr("transform")),k=j.translate,l=j.scale,m=j.rotate,n=a/2*l[0],o=c/2*l[1];i.transition().duration(500).attr("transform","translate("+d/2+","+e/2+")scale("+g+","+h+")rotate("+m+")"),b.select("#"+f._plot.id).transition().duration(500).attr("width",d).attr("height",e)},g.addEdges=function(b){var c;a.isArray(b)?c=this._insertEdges(b):c=this._insertEdges([b]);var d=a.flatten(a.map(c,function(a){return[a.source,a.target]}));this.addNodes(d),w()},g.removeEdges=function(b,c){var d=a.isBoolean(c)?c:Boolean(!1);b==="all"&&(b=f._network.links_array),a.isArray(b)?a.each(b,function(a){f._removeEdge(a)}):a.isObject(b)&&f._removeEdge(b),w();if(!d){var e=x(b),g=x(f._network.links_array),h=a.difference(e,g);this.removeNodes(h)}},g._insertEdges=function(b){return a.filter(a.map(b,d.models.CircVisData.prototype._insertEdge,f),function(b){return!a.isNull(b)})},g.addNodes=function(b){var c=this;a.isArray(b)?f._insertNodes(b):f._insertNodes([b]),a.each(a.uniq(a.pluck(b,"chr")),j)},g.removeNodes=function(b){var c=this;a.isFunction(b)&&(b=a.filter(f._data.features,b)),a.isArray(b)&&(a.each(b,function(a){f._removeNode(a)}),a.each(a.uniq(a.pluck(b,"chr")),j)),a.isObject(b)&&(f._removeNode(b),j(b.chr))};return g};d.CircVis=e,d.models.CircVisData=function(a){d.models.VisData.call(this,a),this.setDataModel(),this.getDataType()=="vq.models.CircVisData"?this._build_data(this.getContents()):console.warn("Unrecognized JSON object.  Expected vq.models.CircVisData object.")},d.models.CircVisData.prototype=d.extend(d.models.VisData),d.models.CircVisData.prototype.setDataModel=function(){this._dataModel=[{label:"_plot.width",id:"PLOT.width",defaultValue:400},{label:"_plot.height",id:"PLOT.height",defaultValue:400},{label:"_plot.container",id:"PLOT.container",optional:!0},{label:"_plot.vertical_padding",id:"PLOT.vertical_padding",defaultValue:0},{label:"_plot.horizontal_padding",id:"PLOT.horizontal_padding",defaultValue:0},{label:"_plot.enable_pan",id:"PLOT.enable_pan",cast:Boolean,defaultValue:!1},{label:"_plot.enable_zoom",id:"PLOT.enable_zoom",cast:Boolean,defaultValue:!1},{label:"_plot.show_legend",id:"PLOT.show_legend",cast:Boolean,defaultValue:!1},{label:"_plot.legend_corner",id:"PLOT.legend_corner",cast:String,defaultValue:"ne"},{label:"_plot.legend_radius",id:"PLOT.legend_radius",cast:Number,defaultValue:25},{label:"_plot.legend_show_rings",id:"PLOT.legend_show_rings",cast:Boolean,defaultValue:!0},{label:"_plot.rotate_degrees",id:"PLOT.rotate_degrees",cast:Number,defaultValue:0},{label:"_plot.tooltip_timeout",id:"PLOT.tooltip_timeout",cast:Number,defaultValue:200},{label:"_data.features",id:"DATA.features",defaultValue:[]},{label:"_data.edges",id:"DATA.edges",defaultValue:[]},{label:"_data.hash",id:"DATA.hash",defaultValue:[]},{label:"_chrom.keys",id:"GENOME.DATA.key_order",defaultValue:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","X","Y"]},{label:"_chrom.length",id:"GENOME.DATA.key_length",defaultValue:[]},{label:"_chrom.reverse_list",id:"GENOME.OPTIONS.key_reverse_list",optional:!0},{label:"_chrom.gap_degrees",id:"GENOME.OPTIONS.gap_degrees",cast:Number,defaultValue:0},{label:"_chrom.label_layout_style",id:"GENOME.OPTIONS.label_layout_style",defaultValue:"default"},{label:"_chrom.label_font_style",id:"GENOME.OPTIONS.label_font_style",cast:String,defaultValue:"16px helvetica, monospaced"},{label:"_chrom.radial_grid_line_width",id:"GENOME.OPTIONS.radial_grid_line_width",cast:Number,defaultValue:null},{label:"_chrom.listener",id:"GENOME.OPTIONS.listener",cast:Function,defaultValue:function(){return null}},{label:"_network._doRender",id:"NETWORK.OPTIONS.render",defaultValue:!0,cast:Boolean},{label:"_network._outer_padding",id:"NETWORK.OPTIONS.outer_padding",defaultValue:0,cast:Number},{label:"_network.node_listener",id:"NETWORK.OPTIONS.node_listener",cast:Function,defaultValue:function(){return null}},{label:"_network.link_listener",id:"NETWORK.OPTIONS.link_listener",cast:Function,defaultValue:function(){return null}},{label:"_network.link_tooltipItems",id:"NETWORK.OPTIONS.link_tooltip_items",defaultValue:{"Node 1 Chr":"sourceNode.chr","Node 1 Start":"sourceNode.start","Node1 End":"sourceNode.end","Node 2 Chr":"targetNode.chr","Node 2 Start":"targetNode.start","Node 2 End":"targetNode.end"}},{label:"_network.link_tooltipLinks",id:"NETWORK.OPTIONS.link_tooltip_links",defaultValue:{}},{label:"_network.link_line_width",id:"NETWORK.OPTIONS.link_line_width",cast:d.utils.VisUtils.wrapProperty,defaultValue:function(a,b){return 1}},{label:"_network.link_alpha",id:"NETWORK.OPTIONS.link_alpha",cast:d.utils.VisUtils.wrapProperty,defaultValue:function(){return.7}},{label:"_network.link_strokeStyle",id:"NETWORK.OPTIONS.link_stroke_style",cast:d.utils.VisUtils.wrapProperty,defaultValue:function(){return"steelblue"}},{label:"_network.node_fillStyle",id:"NETWORK.OPTIONS.node_fill_style",cast:d.utils.VisUtils.wrapProperty,defaultValue:function(){return"green"}},{label:"_network.node_radius",id:"NETWORK.OPTIONS.node_radius",cast:d.utils.VisUtils.wrapProperty,defaultValue:function(){return 3}},{label:"_network.node_highlightMode",id:"NETWORK.OPTIONS.node_highlight_mode",cast:String,defaultValue:"brighten"},{label:"_network.node_tooltipFormat",id:"NETWORK.OPTIONS.node_tooltipFormat",cast:d.utils.VisUtils.wrapProperty,defaultValue:d.utils.VisUtils.network_node_title},{label:"_network.node_tooltipItems",id:"NETWORK.OPTIONS.node_tooltip_items",defaultValue:{Chr:"chr",Start:"start",End:"end"}},{label:"_network.node_tooltipLinks",id:"NETWORK.OPTIONS.node_tooltip_links",defaultValue:{}},{label:"_network.max_node_linkDegree",id:"NETWORK.OPTIONS.max_node_linkdegree",cast:Number,defaultValue:9999},{label:"_network.min_node_linkDegree",id:"NETWORK.OPTIONS.min_node_linkdegree",cast:Number,defaultValue:0},{label:"_network.node_overlap_distance",id:"NETWORK.OPTIONS.node_overlap_distance",cast:Number,defaultValue:12e6},{label:"_network.tile_nodes",id:"NETWORK.OPTIONS.tile_nodes",cast:Boolean,defaultValue:!1},{label:"ticks.tooltipItems",id:"TICKS.OPTIONS.tooltip_items",defaultValue:{Chr:"chr",Start:"start",End:"end",Label:"value"}},{label:"ticks.tooltipLinks",id:"TICKS.OPTIONS.tooltip_links",defaultValue:{}},{label:"ticks.label_map",id:"TICKS.OPTIONS.label_map",defaultValue:[{key:"",label:""}]},{label:"ticks.render_ticks",id:"TICKS.OPTIONS.render_ticks",cast:Boolean,defaultValue:Boolean(!0)},{label:"ticks.label_key",id:"TICKS.OPTIONS.label_key",defaultValue:"value",cast:String},{label:"ticks.height",id:"TICKS.OPTIONS.height",cast:Number,defaultValue:60},{label:"ticks.wedge_width",id:"TICKS.OPTIONS.wedge_width",cast:Number,defaultValue:.2},{label:"ticks.wedge_height",id:"TICKS.OPTIONS.wedge_height",cast:Number,defaultValue:10},{label:"ticks.outer_padding",id:"TICKS.OPTIONS.outer_padding",cast:Number,defaultValue:0},{label:"ticks.listener",id:"TICKS.OPTIONS.listener",cast:Function,defaultValue:function(){return null}},{label:"ticks.display_legend",id:"TICKS.OPTIONS.display_legend",cast:Boolean,defaultValue:!0},{label:"ticks.legend_corner",id:"TICKS.OPTIONS.legend_corner",cast:String,defaultValue:"nw"},{label:"ticks.tile_ticks",id:"TICKS.OPTIONS.tile_ticks",cast:Boolean,defaultValue:!0},{label:"ticks.overlap_distance",id:"TICKS.OPTIONS.overlap_distance",cast:Number,optional:!0},{label:"ticks.fill_style",id:"TICKS.OPTIONS.fill_style",cast:d.utils.VisUtils.wrapProperty,defaultValue:function(){return"red"}},{label:"ticks.stroke_style",id:"TICKS.OPTIONS.stroke_style",cast:d.utils.VisUtils.wrapProperty,defaultValue:function(){return"white"}},{label:"_wedge",id:"WEDGE",optional:!0}]},d.models.CircVisData.prototype._build_data=function(a){var b=a;this._processData(b),this._wedge&&(this._wedge=this._wedge.map(function(a){return new d.models.CircVisData.WedgeData(a)})),this._setupData()},d.models.CircVisData.prototype._setupData=function(){var c={},e,f=[],g,h={},i,j=[],k={},l={},m=[],n=[],o={},p;this.normalizedLength,this.theta=[],this.startAngle_map={};var q=this;this._plot.id="C"+d.utils.VisUtils.guid();if(this._chrom.keys==[]||this._chrom.length==[])console.warn("Chromosome/Ideogram information has not been detected.  Please verify that keys and length/key mappings have been passed into the GENOME.DATA object.");else{var r=this._chrom.keys;a.each(r,function(a,b){c[a]=b}),f=this._chrom.length.filter(function(a){return c[a.chr_name]!==null}),f.sort(function(a,b){return c[a.chr_name]-c[b.chr_name]>0}),p=d.sum(f,function(a){return a.chr_length});var s=1-this._chrom.gap_degrees*r.length/360;e={},a.each(f,function(a){e[a.chr_name.toUpperCase()]=a.chr_length,l[a.chr_name.toUpperCase()]=a.chr_length*s/p}),this.normalizedLength=l;var t={},u=this._plot.rotate_degrees*Math.PI/180,v=this._chrom.gap_degrees*Math.PI/180;a.each(r,function(d,f){h[d]=a.reduce(r.slice(0,c[d]),function(a,b,c){return a+l[r[c]]*2*Math.PI+v},0),o[d]=b.scale.linear().domain([0,e[d.toUpperCase()]]).range([0,2*Math.PI*l[d]]),q._chrom.reverse_list!==undefined&&q._chrom.reverse_list.filter(function(a){return a==d}).length>0?o[d]=b.scale.linear().domain([0,e[d.toUpperCase()]]).range([2*Math.PI*l[d],0]):o[d]=b.scale.linear().domain([0,e[d.toUpperCase()]]).range([0,2*Math.PI*l[d]]),t[d]={key:d,startAngle:h[d],endAngle:h[d]+2*Math.PI*l[d],theta:o[d],angle:2*Math.PI*l[d]}}),this.theta=o,this._ideograms={},this._data.chr={},a.each(q._chrom.keys,function(b){k[b]=h[b]+u,q._ideograms[b]=a.extend(t[b],{wedge:[],_feature_angle:function(a){return this.startAngle+this.theta(a)}}),q._data.chr[b]=[]}),this.startAngle_map=k,this._chrom.groups=t,this._data.features.length&&(this._data.chr=a.groupBy(this._data.features,"chr"));if(this._wedge!==undefined){var w=[],g={};a.each(this._wedge,function(c,e){c._globalData=!0;if(c._globalData=!Boolean(c._data.length))c._data=q._data.features;c._hash=a.isUndefined(c._hash)?q._data.hash:c._hash;if(c._plot_type=="tile"||c._plot_type=="glyph"){var f=c._tile.show_all_tiles?Math.floor((c._plot_height-c._radius()*2)/(c._tile.height+c._tile.padding)):undefined;w=c._plot_type=="tile"?d.utils.VisUtils.layoutChrTiles(c._data,c._tile.overlap_distance,f):d.utils.VisUtils.layoutChrTicks(c._data,c._tile.overlap_distance,f),c._layout={},a.each(w,function(a){c._layout[c._hash(a)]=a.level})}c._chr=c._globalData?q._data.chr:a.groupBy(c._data,"chr"),c._outerRadius=q._plot.height/2-d.sum(q._wedge.slice(0,e),function(a){return a._plot_height+a._outer_padding})-(q.ticks.outer_padding+q.ticks.height),c._outerPlotRadius=c._outerRadius-c._outer_padding,c._innerRadius=c._outerPlotRadius-c._plot_height,a.each(q._chrom.keys,function(a){q._ideograms[a]._outerRadius=q._plot.height/2-q.ticks.outer_padding+q.ticks.height,q._ideograms[a].wedge[e]=c._chr[a]}),c.hovercard=d.hovercard({canvas_id:q._plot.id,include_header:!1,include_footer:!0,self_hover:!0,timeout:q._plot.tooltip_timeout,data_config:c._tooltipItems,tool_config:c._tooltipLinks});if(c._plot_type!="karyotype"){var g=c._value_key;m=Math.sqrt(d.science.stats.variance(a.pluck(c._data,g))),n=d.science.stats.median(a.pluck(c._data,g)),c._min_plotValue=c._min_plotValue===undefined?parseFloat((-1*m+n).toFixed(2)):c._min_plotValue,c._max_plotValue=c._max_plotValue===undefined?parseFloat((m+n).toFixed(2)):c._max_plotValue,c._range_mean=c._base_plotValue!=null?c._base_plotValue:(c._min_plotValue+c._max_plotValue)/2,c._y_linear=b.scale.linear().domain([c._min_plotValue,c._max_plotValue]).range([c._innerRadius,c._outerRadius-c._outer_padding]).nice(),c._y_axis=b.scale.linear().domain([c._min_plotValue,c._max_plotValue]).range([c._innerRadius,c._outerPlotRadius]),c._thresholded_innerRadius=function(a){return Math.max(c._y_axis(Math.min(a,c._range_mean)),c._innerRadius)},c._thresholded_outerRadius=function(a){return Math.min(c._y_axis(Math.max(a,c._range_mean)),c._outerPlotRadius)},c._thresholded_value_to_radius=function(a){return Math.min(Math.max(c._y_axis(a),c._innerRadius),c._outerPlotRadius)},c._thresholded_radius=function(a){return Math.min(Math.max(a,c._innerRadius),c._outerPlotRadius)},c._thresholded_tile_innerRadius=function(a,b){return c._innerRadius+(b._tile.height+b._tile.padding)*c._layout[c._hash(a)]},c._thresholded_tile_outerRadius=function(a,b){return c._innerRadius+(b._tile.height+b._tile.padding)*c._layout[c._hash(a)]+b._tile.height},c._plot_type=="glyph"&&(c._glyph_distance=function(a){return(c._tile.height+c._tile.padding)*c._layout[c._hash(a)]+c._innerRadius+c._radius(a)},c._checked_endAngle=function(a,b){return q._chrom.keys.length==1?Math.min(q.startAngle_map[b]+q.theta[b](a.end||a.start+1),q.startAngle_map[q._chrom.keys[0]]+Math.PI*2):this.parent.index+1==q._chrom.keys.length?Math.min(q.startAngle_map[b]+q.theta[b](a.end||a.start+1),q.startAngle_map[q._chrom.keys[0]]+Math.PI*2):Math.min(q.startAngle_map[b]+q.theta[b](a.end||a.start+1),q.startAngle_map[q._chrom.keys[(this.parent.index+1)%q._chrom.keys.length]])}),delete c._data}})}if(q.ticks.tile_ticks){if(q.ticks.overlap_distance===undefined){var x=7e6/3080419480;q.ticks.overlap_distance=x*p}var y=d.utils.VisUtils.layoutChrTicks(this._data.features,q.ticks.overlap_distance),z=this.ticks._layout={},A=q._data.hash;a.each(y,function(a){z[A(a)]=a.level})}this.ticks.data_map=q._data.chr,this.ticks.hovercard=d.hovercard({canvas_id:q._plot.id,include_header:!1,include_footer:!0,self_hover:!0,timeout:q._plot.tooltip_timeout,data_config:q.ticks.tooltipItems,tool_config:q.ticks.tooltipLinks});var B={};a.each(q._chrom.keys,function(a){B[a]={}});var C={},D=[{parent:null,chr:null,radius:0,angle:0}];q._network.network_radius={},q._network.layout={},r.forEach(function(a,b){var c=q._ideograms[a].wedge.length>0?q._wedge[q._ideograms[a].wedge.length-1]._innerRadius:q._plot.height/2-q.ticks.outer_padding-q.ticks.height,d=q._network.network_radius[a]=c-q._network._outer_padding;C[a]=
b+1;var e={chr:a,parent:D[0],radius:d/2,angle:(q._chrom.groups[a].startAngle+q._chrom.groups[a].endAngle)/2};D.push(e)}),this._network.node_parent_map=C,this._network.nodes_array=D,this._network.links_array=[],this._network.link_hovercard=d.hovercard({canvas_id:q._plot.id,include_header:!1,include_footer:!0,self_hover:!0,timeout:q._plot.tooltip_timeout,data_config:q._network.link_tooltipItems,tool_config:q._network.link_tooltipLinks}),this._network.node_hovercard=d.hovercard({canvas_id:q._plot.id,include_header:!1,include_footer:!0,self_hover:!0,timeout:q._plot.tooltip_timeout,data_config:q._network.node_tooltipItems,tool_config:q._network.node_tooltipLinks}),this._insertEdges(q._data.edges),this.setDataReady(!0)}},d.models.CircVisData.prototype._remove_wedge_data=function(b){var c=this,d=b.chr;a.each(this._ideograms[d].wedge,function(e,f){e._globalData&&(c._ideograms[d].wedge[f]=a.reject(e,function(a){return c.same_feature(a,b)}))})},d.models.CircVisData.prototype._add_wedge_data=function(b){var c=this,d=b.chr;a.each(this._ideograms[d].wedge,function(d,e){if(d._globalData){if(a.isUndefined(b[c._wedge[e]._value_key])||c._wedge[e]._plot_type=="karyotype")return;d.push(b)}})},d.models.CircVisData.prototype.same_feature=function(a,b){return this._data.hash(a)==this._data.hash(b)},d.models.CircVisData.prototype.same_edge=function(a,b){return this.same_feature(a.source,b.source)&&this.same_feature(a.target,b.target)},d.models.CircVisData.prototype._retileWedge=function(){var b=this;a.each(this._wedge,function(c,e){var f=c._globalData?b._data.features:c._data;if(c._plot_type=="tile"||c._plot_type=="glyph"){var g=c._tile.show_all_tiles?Math.floor((c._plot_height-c._radius()*2)/(c._tile.height+c._tile.padding)):undefined,h=c._plot_type=="tile"?d.utils.VisUtils.layoutChrTiles(f,c._tile.overlap_distance,g):d.utils.VisUtils.layoutChrTicks(f,c._tile.overlap_distance,g);c._layout={},a.each(h,function(a){c._layout[c._hash(a)]=a.level})}})},d.models.CircVisData.prototype._retileTicks=function(){var b=this,c,e=d.utils.VisUtils.layoutChrTicks(this._data.features,this.ticks.overlap_distance),f=this.ticks._layout,g=b._data.hash;a.each(e,function(a){f[g(a)]=a.level})},d.models.CircVisData.prototype._format_network_node=function(b){function f(b){var e,f=c._network.nodes_array[d[b.chr]];if(!a.isUndefined(f)){e=a.extend({parent:f},b);return e}return null}var c=this,d=this._network.node_parent_map,e=this._data.hash;if(a.isArray(b))return a.compact(a.map(b,f,c));return f.call(c,b)},d.models.CircVisData.prototype._remove_layouts=function(b){var c=this,d=this._data.hash(b);delete this.ticks._layout[d],delete this._network.layout[d],a.each(this._wedge,function(a){a._layout&&a._layout[d]&&delete a._layout[d]})},d.models.CircVisData.prototype._remove_feature=function(b){var c=this,d=-1;a.each(this._data.chr[b.chr],function(a,e){c.same_feature(a,b)&&(d=e)}),!~d||this._data.chr[b.chr].splice(d,1),d=-1,a.each(this._data.features,function(a,e){c.same_feature(a,b)&&(d=e)}),!~d||this._data.features.splice(d,1);return this},d.models.CircVisData.prototype._insertNode=function(b){var c=this,d,e=this._data.hash;if(!a.include(a.keys(c._chrom.groups),b.chr))return null;if(d=a.find(c._data.features,function(a){return e(a)===e(b)}))return d;c._data.features.push(b),c._data.chr[b.chr].push(b);return b},d.models.CircVisData.prototype._insertNodes=function(b){var c=this,d=[],e=a.map(b,this._insertNode,this);this._retile();return e},d.models.CircVisData.prototype._retile=function(){this._retileNodes(),this._retileTicks(),this._retileWedge();return this},d.models.CircVisData.prototype._retileNodes=function(){var b=this;this._network.tile_nodes&&this._data.features.length&&(nodes=d.utils.VisUtils.layoutChrTiles(b._data.features,b._network.node_overlap_distance),a.each(nodes,function(a){b._network.layout[b._data.hash(a)]=a.level}));return this},d.models.CircVisData.prototype._removeNode=function(b){!a.isObject(b)||this._remove_feature(b)},d.models.CircVisData.prototype._insertEdges=function(b){var c=this;a.each(b,this._insertEdge,c)},d.models.CircVisData.prototype._insertEdge=function(b){var c=[b.node1,b.node2],d=this;if(a.any(c,function(b){return a.isNull(b)||!a.include(a.keys(d._chrom.groups),b.chr)})){console.log("Unmappable chromosome in edge: 1:"+c[0].chr+", 2:"+c[1].chr);return null}var e=a.map([c[0],c[1]],d._insertNode,d);if(a.any(e,function(b){return a.isNull(b)})){console.error("Unable to insert node for requested edge");return null}var f=a.chain(b).keys().reject(function(a){return a=="node1"||a=="node2"}).value();e=a.map(e,this._format_network_node,this);var g=a.chain(b).pick(f).extend({source:e[0],target:e[1]}).value();if(a.any(this._network.links_array,function(a){return d.same_edge(g,a)}))return null;this._network.links_array.push(g);return g},d.models.CircVisData.prototype._removeEdge=function(b){var c=this;if(a.isObject(b)){var d=-1;a.each(this._network.links_array,function(e,f){c.same_edge(e,a.extend({},{source:b.node1,target:b.node2},b))&&(d=f)}),d&&this._network.links_array.splice(d,1)}},d.models.CircVisData.prototype._removeEdges=function(b){var c=this;a.isArray(b)&&a.each(b,this._removeEdge,this)},d.models.CircVisData.WedgeData=function(a){d.models.VisData.call(this,{CONTENTS:a}),this.setDataModel(),this._build_data(this.getContents())},d.models.CircVisData.WedgeData.prototype=d.extend(d.models.VisData),d.models.CircVisData.WedgeData.prototype.setDataModel=function(){this._dataModel=[{label:"_data",id:"DATA.data_array",defaultValue:[]},{label:"_value_key",id:"DATA.value_key",defaultValue:"value",cast:String},{label:"_hash",id:"DATA.hash",optional:!0,cast:d.utils.VisUtils.wrapProperty},{label:"listener",id:"OPTIONS.listener",defaultValue:function(a,b){}},{label:"_plot_type",id:"PLOT.type",defaultValue:"histogram"},{label:"_plot_height",id:"PLOT.height",cast:Number,defaultValue:100},{label:"_fillStyle",id:"OPTIONS.fill_style",cast:d.utils.VisUtils.wrapProperty,defaultValue:function(a){return"red"}},{label:"_strokeStyle",id:"OPTIONS.stroke_style",cast:d.utils.VisUtils.wrapProperty,defaultValue:function(a){return"black"}},{label:"_lineWidth",id:"OPTIONS.line_width",cast:Number,defaultValue:.5},{label:"_shape",id:"OPTIONS.shape",cast:d.utils.VisUtils.wrapProperty,defaultValue:function(a){return"circle"}},{label:"_radius",id:"OPTIONS.radius",cast:d.utils.VisUtils.wrapProperty,defaultValue:function(a){return 2}},{label:"_outer_padding",id:"OPTIONS.outer_padding",cast:Number,defaultValue:1},{label:"_min_plotValue",id:"OPTIONS.min_value",cast:Number,optional:!0},{label:"_max_plotValue",id:"OPTIONS.max_value",cast:Number,optional:!0},{label:"_base_plotValue",id:"OPTIONS.base_value",cast:Number,optional:!0},{label:"_legend_label",id:"OPTIONS.legend_label",cast:String,defaultValue:""},{label:"_legend_desc",id:"OPTIONS.legend_description",cast:String,defaultValue:""},{label:"_draw_axes",id:"OPTIONS.draw_axes",cast:Boolean,defaultValue:!0},{label:"_show_tooltips",id:"OPTIONS.show_tooltips",cast:Boolean,defaultValue:!0},{label:"_tooltipFormat",id:"OPTIONS.tooltipFormat",cast:d.utils.VisUtils.wrapProperty,defaultValue:function(a,b){return"Chr "+b+"\nStart: "+a.start+"\nEnd: "+a.end}},{label:"_tooltipItems",id:"OPTIONS.tooltip_items",defaultValue:{Chr:"chr",Start:"start",End:"end",Value:"value"}},{label:"_tooltipLinks",id:"OPTIONS.tooltip_links",defaultValue:{}},{label:"_tile.padding",id:"OPTIONS.tile_padding",cast:Number,defaultValue:5},{label:"_tile.overlap_distance",id:"OPTIONS.tile_overlap_distance",cast:Number,defaultValue:.1},{label:"_tile.height",id:"OPTIONS.tile_height",cast:Number,defaultValue:5},{label:"_tile.show_all_tiles",id:"OPTIONS.tile_show_all_tiles",cast:Boolean,defaultValue:!1}]},d.models.CircVisData.WedgeData.prototype._build_data=function(a){this._processData(a)};return d})